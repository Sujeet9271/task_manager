{% load static %}
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Board Dashboard</title>
    <link rel="stylesheet" href="{% static 'assets/bootstrap/css/bootstrap.min.css' %}">
    <link rel="stylesheet" href="{% static 'css/styles.css' %}">
    <script src="{% static 'assets/htmx/js/htmx.min.js' %}"></script>
    <script src="{% static 'js/common.js' %}"></script>
</head>
<body hx-headers='{"X-CSRFToken": "{{ csrf_token }}"}' hx-indicator='.gif_loader'>
    <div id="loader">
        <div id="loader_div">
        <img src="{% static 'gif/gif.gif' %}" alt="gif">
        </div>
    </div>

<!-- Top Bar -->
<nav class="navbar navbar-expand-lg navbar-dark bg-dark">
    <div class="container-fluid justify-content-between">
        <span class="navbar-text text-white">
            Logged in as: {{ request.user.username }}
        </span>
        <a href="" class="btn btn-outline-light">Logout</a>
    </div>
</nav>

<div class="container-fluid">
    <div class="row">

        <!-- Sidebar -->
        <div class="col-md-3 col-lg-2 bg-light p-3 border-end" style="height: 100vh;">
            <h5>Boards</h5>
            <ul class="nav flex-column">
                {% for board in boards %}
                <li class="nav-item">
                    <a href="{% url 'board:board-view' board.id %}" 
                       class="nav-link"
                       hx-get="{% url 'board:board-view' board.id %}" 
                       hx-target="#content" 
                       hx-swap="innerHTML">
                        {{ board.name }}
                    </a>
                </li>
                {% endfor %}
            </ul>
        </div>

        <!-- Main Content -->
        <div class="col-md-9 col-lg-10 p-4" id="content">
            <h4>Select a board to view its content.</h4>
        </div>

    </div>

    <div class="modal fade" id="editTaskModal" tabindex="-1" role="dialog" aria-labelledby="editTaskModalLabel" aria-hidden="true">
        <div class="modal-dialog" role="document">
          <div class="modal-content">
            <div class="modal-header">
              <h5 class="modal-title" id="editTaskModalLabel">Edit Task</h5>
            </div>
            <div class="modal-body" id="edit_task_modal">
              Editing task content here.
            </div>
          </div>
        </div>
    </div>

    <div class="modal fade" id="createColumnModal" tabindex="-1" role="dialog" aria-labelledby="createColumnModalLabel" aria-hidden="true">
        <div class="modal-dialog" role="document">
          <div class="modal-content">
            <div class="modal-header">
              <h5 class="modal-title" id="createColumnModalLabel">Create Column</h5>
              
            </div>
            <div class="modal-body" id="create_column_modal">
                
            </div>
            <div class="modal-footer">
              <button type="button" class="btn btn-secondary" data-bs-dismiss="modal" id="close_createColumnModal">Close</button>
            </div>
          </div>
        </div>
    </div>

</div>

<script src="{% static 'assets/bootstrap/js/bootstrap.bundle.min.js' %}"></script>
</body>
<script>
    const editTaskModal = document.getElementById('editTaskModal')
    editTaskModal.addEventListener('hidden.bs.modal', event => {
        event.target.querySelector('.modal-body').innerHTML = ''
    })

    htmx.on("reloadBoard",function(evt){
        board_url = evt.detail.message
        htmx.ajax('GET', board_url, {target:'#content', swap:'innerhTML'})
        document.getElementById('close_createColumnModal').click()
    })
    htmx.on("taskEdited",function(evt){
        board_url = evt.detail.message
        htmx.ajax('GET', board_url, {target:'#content', swap:'innerhTML'})
        document.getElementById('close_editTaskModal').click()
    })
    htmx.on("taskCreated",function(evt){
        board_id = evt.detail.board_id
        column_id = evt.detail.column_id
        get_task_lists = evt.detail.message
        document.getElementById(`create_task_form_${ column_id }`).reset()
    })
</script>
</html>
